<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>

    <script>
      // window.addEventListener("load", () => {
      //   if (
      //     typeof THREE !== "undefined" &&
      //     THREE.Material &&
      //     !("markersAreaEnabled" in THREE.Material.prototype)
      //   ) {
      //     THREE.Material.prototype.markersAreaEnabled = false;
      //   }

      //   setTimeout(() => {
      //     window.dispatchEvent(
      //       new UIEvent("resize", { bubbles: true, cancelable: false })
      //     );
      //   }, 3000);

      //   // =================== Ch·ª£ B·∫øn Th√†nh ===================
      //   let audioChoBenThanh = new Audio("./media/Audio/chobenthanh.mp4");
      //   let imageIndexCho = 0;
      //   const imageSourcesCho = ["#image1", "#image2", "#image3"];
      //   let intervalSetCho = false;
      //   const markerCho = document.getElementById("marker-cho");
      //   const imageElementCho = document.getElementById("img-cho");

      //   markerCho.addEventListener("markerFound", () => {
      //     console.log("üìç Marker Ch·ª£ B·∫øn Th√†nh ƒë∆∞·ª£c ph√°t hi·ªán!");
      //     audioChoBenThanh.currentTime = 0;
      //     audioChoBenThanh
      //       .play()
      //       .catch((err) => console.warn("‚ùå L·ªói ph√°t √¢m thanh:", err));

      //     if (!intervalSetCho) {
      //       intervalSetCho = true;
      //       setInterval(() => {
      //         imageIndexCho = (imageIndexCho + 1) % imageSourcesCho.length;
      //         imageElementCho.setAttribute(
      //           "material",
      //           "src",
      //           imageSourcesCho[imageIndexCho]
      //         );
      //       }, 3000);
      //     }
      //   });

      //   markerCho.addEventListener("markerLost", () => {
      //     audioChoBenThanh.pause();
      //     audioChoBenThanh.currentTime = 0;
      //   });

      //   // =================== Ch√πa M·ªôt C·ªôt ===================
      //   let audioChuaMotCot = new Audio("./media/Audio/chuamotcot.mp4");
      //   let imageIndexChua = 0;
      //   const imageSourcesChua = ["#image4", "#image5", "#image6"];
      //   let intervalSetChua = false;
      //   const markerChua = document.getElementById("marker-chua");
      //   const imageElementChua = document.getElementById("img-chua");

      //   markerChua.addEventListener("markerFound", () => {
      //     console.log("üìç Marker Ch√πa M·ªôt C·ªôt ƒë∆∞·ª£c ph√°t hi·ªán!");
      //     audioChuaMotCot.currentTime = 0;
      //     audioChuaMotCot
      //       .play()
      //       .catch((err) => console.warn("‚ùå L·ªói ph√°t √¢m thanh:", err));

      //     if (!intervalSetChua) {
      //       intervalSetChua = true;
      //       setInterval(() => {
      //         imageIndexChua = (imageIndexChua + 1) % imageSourcesChua.length;
      //         imageElementChua.setAttribute(
      //           "material",
      //           "src",
      //           imageSourcesChua[imageIndexChua]
      //         );
      //       }, 3000);
      //     }
      //   });

      //   markerChua.addEventListener("markerLost", () => {
      //     audioChuaMotCot.pause();
      //     audioChuaMotCot.currentTime = 0;
      //   });

      //   // =================== Ch√πa V√†ng ===================
      //   let audioChuaVang = new Audio("./media/Audio/cauvang.mp4");
      //   let imageIndexVang = 0;
      //   const imageSourcesVang = ["#image7", "#image8", "#image9"];
      //   let intervalSetVang = false;
      //   const markerVang = document.getElementById("marker-vang");
      //   const imageElementVang = document.getElementById("img-vang");

      //   markerVang.addEventListener("markerFound", () => {
      //     console.log("üìç Marker Ch√πa V√†ng ƒë∆∞·ª£c ph√°t hi·ªán!");
      //     audioChuaVang.currentTime = 0;
      //     audioChuaVang
      //       .play()
      //       .catch((err) => console.warn("‚ùå L·ªói ph√°t √¢m thanh:", err));

      //     if (!intervalSetVang) {
      //       intervalSetVang = true;
      //       setInterval(() => {
      //         imageIndexVang = (imageIndexVang + 1) % imageSourcesVang.length;
      //         imageElementVang.setAttribute(
      //           "material",
      //           "src",
      //           imageSourcesVang[imageIndexVang]
      //         );
      //       }, 3000);
      //     }
      //   });

      //   markerVang.addEventListener("markerLost", () => {
      //     audioChuaVang.pause();
      //     audioChuaVang.currentTime = 0;
      //   });

      //   // =================== Ch√πa Som Rong ===================
      //   let audioChuaSomRong = new Audio("./media/Audio/chuasomrong.mp4");
      //   let imageIndexSomRong = 0;
      //   const imageSourcesSomRong = ["#image10", "#image11", "#image12"];
      //   let intervalSetSomRong = false;
      //   const markerSomRong = document.getElementById("marker-somrong");
      //   const imageElementSomRong = document.getElementById("img-somrong");

      //   markerSomRong.addEventListener("markerFound", () => {
      //     console.log("üìç Marker Ch√πa Som Rong ƒë∆∞·ª£c ph√°t hi·ªán!");
      //     audioChuaSomRong.currentTime = 0;
      //     audioChuaSomRong
      //       .play()
      //       .catch((err) => console.warn("‚ùå L·ªói ph√°t √¢m thanh:", err));

      //     if (!intervalSetSomRong) {
      //       intervalSetSomRong = true;
      //       setInterval(() => {
      //         imageIndexSomRong =
      //           (imageIndexSomRong + 1) % imageSourcesSomRong.length;
      //         imageElementSomRong.setAttribute(
      //           "material",
      //           "src",
      //           imageSourcesSomRong[imageIndexSomRong]
      //         );
      //       }, 3000);
      //     }
      //   });

      //   markerSomRong.addEventListener("markerLost", () => {
      //     audioChuaSomRong.pause();
      //     audioChuaSomRong.currentTime = 0;
      //   });
      // });

      window.addEventListener("load", () => {
  let isLocked = false; // Bi·∫øn ƒë·ªÉ ki·ªÉm so√°t tr·∫°ng th√°i kh√≥a
  let intervalId = null; // L∆∞u interval ƒë·ªÉ d·ª´ng khi c·∫ßn
  let currentImageElement = null; // L∆∞u h√¨nh ·∫£nh hi·ªán t·∫°i

  function setupMarker(markerId, imageElementId, audioSrc, imageSources) {
    let audio = new Audio(audioSrc);
    let imageIndex = 0;
    const marker = document.getElementById(markerId);
    const imageElement = document.getElementById(imageElementId);

    marker.addEventListener("markerFound", () => {
      if (isLocked) return; // N·∫øu ƒë√£ kh√≥a, kh√¥ng ch·∫°y ti·∫øp

      console.log(`üìç Marker ${markerId} ƒë∆∞·ª£c ph√°t hi·ªán!`);
      isLocked = true; // Kh√≥a l·∫°i

      audio.currentTime = 0;
      audio.play().catch((err) => console.warn("‚ùå L·ªói ph√°t √¢m thanh:", err));

      // L∆∞u h√¨nh ·∫£nh ƒëang hi·ªÉn th·ªã
      currentImageElement = imageElement;
      currentImageElement.setAttribute("visible", "true"); // Gi·ªØ h√¨nh ·∫£nh ngay c·∫£ khi m·∫•t marker

      if (!intervalId) {
        intervalId = setInterval(() => {
          imageIndex = (imageIndex + 1) % imageSources.length;
          imageElement.setAttribute("material", "src", imageSources[imageIndex]);
        }, 3000);
      }
    });

    marker.addEventListener("markerLost", () => {
      console.log(`‚ö† Marker ${markerId} m·∫•t, nh∆∞ng h√¨nh ·∫£nh v·∫´n gi·ªØ!`);
      if (isLocked) {
        currentImageElement.setAttribute("visible", "true"); // V·∫´n gi·ªØ h√¨nh khi m·∫•t marker
      }
    });

    document.body.addEventListener("click", () => {
      if (isLocked) {
        console.log(`üîì ƒê√£ m·ªü kh√≥a s·ª± ki·ªán cho ${markerId}`);
        isLocked = false;
        audio.pause();
        audio.currentTime = 0;

        if (intervalId) {
          clearInterval(intervalId);
          intervalId = null;
        }

        if (currentImageElement) {
          currentImageElement.setAttribute("visible", "false"); // ·∫®n h√¨nh ·∫£nh khi b·∫•m v√†o m√†n h√¨nh
        }
      }
    });
  }

  // C·∫•u h√¨nh c√°c marker
  setupMarker("marker-cho", "img-cho", "./media/Audio/chobenthanh.mp4", ["#image1", "#image2", "#image3"]);
  setupMarker("marker-chua", "img-chua", "./media/Audio/chuamotcot.mp4", ["#image4", "#image5", "#image6"]);
  setupMarker("marker-vang", "img-vang", "./media/Audio/cauvang.mp4", ["#image7", "#image8", "#image9"]);
  setupMarker("marker-somrong", "img-somrong", "./media/Audio/chuasomrong.mp4", ["#image10", "#image11", "#image12"]);
});

    </script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-assets>
        <!-- H√¨nh ·∫£nh Ch·ª£ B·∫øn Th√†nh -->
        <img id="image1" src="./media/image/cho-ben-thanh.jpg" />
        <img id="image2" src="./media/image/cho-ben-thanh2.jpg" />
        <img id="image3" src="./media/image/cho-ben-thanh3.jpg" />

        <!-- H√¨nh ·∫£nh Ch√πa M·ªôt C·ªôt -->
        <img id="image4" src="./media/image/chuamotchot1.jpg" />
        <img id="image5" src="./media/image/chuamotcot2.jpg" />
        <img id="image6" src="./media/image/chuamotcot3.jpg" />

        <!-- H√¨nh ·∫£nh Ch√πa V√†ng -->
        <img id="image7" src="./media/image/cv1.jpg" />
        <img id="image8" src="./media/image/cv2.jpg" />
        <img id="image9" src="./media/image/cv3.jpg" />

        <img id="image10" src="./media/image/csr1.jpg" />
        <img id="image11" src="./media/image/csr2.jpg" />
        <img id="image12" src="./media/image/csr3.jpg" />
      </a-assets>

      <!-- Marker Ch·ª£ B·∫øn Th√†nh -->
      <a-marker
        preset="custom"
        type="pattern"
        url="./marker/btn2-50.patt"
        id="marker-cho"
      >
        <a-image
          id="img-cho"
          material="src: #image1"
          width="16"
          height="9"
          position="0 0 0"
          rotation="-90 0 0"
          scale="0.1 0.2 1"
        ></a-image>
        <a-text
          value="Market Cho Ben Thanh"
          color="#FFFFFF"
          width="3"
          align="center"
          position="0 2 0"
          rotation="-90 0 0"
        ></a-text>
      </a-marker>

      <!-- Marker Ch√πa M·ªôt C·ªôt -->
      <a-marker
        preset="custom"
        type="pattern"
        url="./marker/cmc-55.patt"
        id="marker-chua"
      >
        <a-image
          id="img-chua"
          material="src: #image4"
          width="16"
          height="9"
          position="0 0 0"
          rotation="-90 0 0"
          scale="0.1 0.2 1"
        ></a-image>
        <a-text
          value="One Pillar Pagoda"
          color="#FFFFFF"
          width="3"
          align="center"
          position="0 2 0"
          rotation="-90 0 0"
        ></a-text>
      </a-marker>

      <!-- Marker Ch√πa V√†ng -->
      <a-marker
        preset="custom"
        type="pattern"
        url="./marker/cv-55.patt"
        id="marker-vang"
      >
        <a-image
          id="img-vang"
          material="src: #image7"
          width="16"
          height="9"
          position="0 0 0"
          rotation="-90 0 0"
          scale="0.1 0.2 1"
        ></a-image>
        <a-text
          value="Shwedagon Pagoda"
          color="#FFD700"
          width="3"
          align="center"
          position="0 2 0"
          rotation="-90 0 0"
        ></a-text>
      </a-marker>

      <a-marker
        preset="custom"
        type="pattern"
        url="./marker/csr-55.patt"
        id="marker-somrong"
      >
        <a-image
          id="img-somrong"
          material="src: #image10"
          width="16"
          height="9"
          position="0 0 0"
          rotation="-90 0 0"
          scale="0.1 0.2 1"
          visible="true"
        ></a-image>
        <a-text
          value="Chua Som Rong"
          color="#FFD700"
          width="3"
          align="center"
          position="0 2 0"
          rotation="-90 0 0"
        ></a-text>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>