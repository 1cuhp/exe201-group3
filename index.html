<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0"
    />
    <!-- A-Frame -->
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <!-- AR.js -->
    <script src="https://cdn.rawgit.com/jeromeetienne/AR.js/master/aframe/build/aframe-ar.min.js"></script>

    <script>
      window.addEventListener("load", () => {
        if (
          typeof THREE !== "undefined" &&
          THREE.Material &&
          !("markersAreaEnabled" in THREE.Material.prototype)
        ) {
          THREE.Material.prototype.markersAreaEnabled = false;
        }

        setTimeout(() => {
          window.dispatchEvent(
            new UIEvent("resize", { bubbles: true, cancelable: false })
          );
        }, 3000);

        // =================== Chợ Bến Thành ===================
        let audioChoBenThanh = new Audio("./media/Audio/chobenthanh.mp4");
        let imageIndexCho = 0;
        const imageSourcesCho = ["#image1", "#image2", "#image3"];
        let intervalSetCho = false;
        const markerCho = document.getElementById("marker-cho");
        const imageElementCho = document.getElementById("img-cho");

        markerCho.addEventListener("markerFound", () => {
          console.log("📍 Marker Chợ Bến Thành được phát hiện!");
          audioChoBenThanh.currentTime = 0;
          audioChoBenThanh
            .play()
            .catch((err) => console.warn("❌ Lỗi phát âm thanh:", err));

          if (!intervalSetCho) {
            intervalSetCho = true;
            setInterval(() => {
              imageIndexCho = (imageIndexCho + 1) % imageSourcesCho.length;
              imageElementCho.setAttribute(
                "material",
                "src",
                imageSourcesCho[imageIndexCho]
              );
            }, 3000);
          }
        });

        markerCho.addEventListener("markerLost", () => {
          audioChoBenThanh.pause();
          audioChoBenThanh.currentTime = 0;
        });

        // =================== Chùa Một Cột ===================
        let audioChuaMotCot = new Audio("./media/Audio/chuamotcot.mp4");
        let imageIndexChua = 0;
        const imageSourcesChua = ["#image4", "#image5", "#image6"];
        let intervalSetChua = false;
        const markerChua = document.getElementById("marker-chua");
        const imageElementChua = document.getElementById("img-chua");

        markerChua.addEventListener("markerFound", () => {
          console.log("📍 Marker Chùa Một Cột được phát hiện!");
          audioChuaMotCot.currentTime = 0;
          audioChuaMotCot
            .play()
            .catch((err) => console.warn("❌ Lỗi phát âm thanh:", err));

          if (!intervalSetChua) {
            intervalSetChua = true;
            setInterval(() => {
              imageIndexChua = (imageIndexChua + 1) % imageSourcesChua.length;
              imageElementChua.setAttribute(
                "material",
                "src",
                imageSourcesChua[imageIndexChua]
              );
            }, 3000);
          }
        });

        markerChua.addEventListener("markerLost", () => {
          audioChuaMotCot.pause();
          audioChuaMotCot.currentTime = 0;
        });

        markerVang.addEventListener("markerFound", () => {
          console.log("📍 Marker Chùa Vàng được phát hiện!");
          audioChuaVang.currentTime = 0;
          audioChuaVang
            .play()
            .catch((err) => console.warn("❌ Lỗi phát âm thanh:", err));

          if (!intervalSetVang) {
            intervalSetVang = true;
            setInterval(() => {
              imageIndexVang = (imageIndexVang + 1) % imageSourcesVang.length;
              imageElementVang.setAttribute(
                "material",
                "src",
                imageSourcesVang[imageIndexVang]
              );
            }, 3000);
          }
        });

        // 🔴 THÊM SỰ KIỆN markerLost để dừng âm thanh Chùa Vàng
        markerVang.addEventListener("markerLost", () => {
          console.log("❌ Marker Chùa Vàng bị mất!");
          audioChuaVang.pause();
          audioChuaVang.currentTime = 0; // Reset âm thanh về đầu
        });
        // =================== Chùa Som Rong ===================
        let audioChuaSomRong = new Audio("./media/Audio/chuasomrong.mp4");
        let imageIndexSomRong = 0;
        const imageSourcesSomRong = ["#image10", "#image11", "#image12"];
        let intervalSetSomRong = false;
        const markerSomRong = document.getElementById("marker-somrong");
        const imageElementSomRong = document.getElementById("img-somrong");

        markerSomRong.addEventListener("markerFound", () => {
          console.log("📍 Marker Chùa Som Rong được phát hiện!");
          audioChuaSomRong.currentTime = 0;
          audioChuaSomRong
            .play()
            .catch((err) => console.warn("❌ Lỗi phát âm thanh:", err));

          if (!intervalSetSomRong) {
            intervalSetSomRong = true;
            setInterval(() => {
              imageIndexSomRong =
                (imageIndexSomRong + 1) % imageSourcesSomRong.length;
              imageElementSomRong.setAttribute(
                "material",
                "src",
                imageSourcesSomRong[imageIndexSomRong]
              );
            }, 3000);
          }
        });

        markerSomRong.addEventListener("markerLost", () => {
          audioChuaSomRong.pause();
          audioChuaSomRong.currentTime = 0;
        });
      });
    </script>
  </head>
  <body style="margin: 0; overflow: hidden">
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;">
      <a-assets>
        <!-- Hình ảnh Chợ Bến Thành -->
        <img id="image1" src="./media/image/cho-ben-thanh.jpg" />
        <img id="image2" src="./media/image/cho-ben-thanh2.jpg" />
        <img id="image3" src="./media/image/cho-ben-thanh3.jpg" />

        <!-- Hình ảnh Chùa Một Cột -->
        <img id="image4" src="./media/image/chuamotchot1.jpg" />
        <img id="image5" src="./media/image/chuamotcot2.jpg" />
        <img id="image6" src="./media/image/chuamotcot3.jpg" />

        <!-- Hình ảnh Chùa Vàng -->
        <img id="image7" src="./media/image/cv1.jpg" />
        <img id="image8" src="./media/image/cv2.jpg" />
        <img id="image9" src="./media/image/cv3.jpg" />

        <img id="image10" src="./media/image/csr1.jpg" />
        <img id="image11" src="./media/image/csr2.jpg" />
        <img id="image12" src="./media/image/csr3.jpg" />
      </a-assets>

      <!-- Marker Chợ Bến Thành -->
      <a-marker
        preset="custom"
        type="pattern"
        url="./marker/btn2-50.patt"
        id="marker-cho"
      >
        <a-image
          id="img-cho"
          material="src: #image1"
          width="16"
          height="9"
          position="0 0 0"
          rotation="-90 0 0"
          scale="0.1 0.2 1"
        ></a-image>
        <a-text
          value="Market Cho Ben Thanh"
          color="#FFFFFF"
          width="3"
          align="center"
          position="0 2 0"
          rotation="-90 0 0"
        ></a-text>
      </a-marker>

      <!-- Marker Chùa Một Cột -->
      <a-marker
        preset="custom"
        type="pattern"
        url="./marker/cmc-55.patt"
        id="marker-chua"
      >
        <a-image
          id="img-chua"
          material="src: #image4"
          width="16"
          height="9"
          position="0 0 0"
          rotation="-90 0 0"
          scale="0.1 0.2 1"
        ></a-image>
        <a-text
          value="One Pillar Pagoda"
          color="#FFFFFF"
          width="3"
          align="center"
          position="0 2 0"
          rotation="-90 0 0"
        ></a-text>
      </a-marker>

      <!-- Marker Chùa Vàng -->
      <a-marker
        preset="custom"
        type="pattern"
        url="./marker/cv-55.patt"
        id="marker-vang"
      >
        <a-image
          id="img-vang"
          material="src: #image7"
          width="16"
          height="9"
          position="0 0 0"
          rotation="-90 0 0"
          scale="0.1 0.2 1"
        ></a-image>
        <a-text
          value="Shwedagon Pagoda"
          color="#FFD700"
          width="3"
          align="center"
          position="0 2 0"
          rotation="-90 0 0"
        ></a-text>
      </a-marker>

      <a-marker
        preset="custom"
        type="pattern"
        url="./marker/csr-55.patt"
        id="marker-somrong"
      >
        <a-image
          id="img-somrong"
          material="src: #image10"
          width="16"
          height="9"
          position="0 0 0"
          rotation="-90 0 0"
          scale="0.1 0.2 1"
          visible="true"
        ></a-image>
        <a-text
          value="Chua Som Rong"
          color="#FFD700"
          width="3"
          align="center"
          position="0 2 0"
          rotation="-90 0 0"
        ></a-text>
      </a-marker>

      <a-entity camera></a-entity>
    </a-scene>
  </body>
</html>
